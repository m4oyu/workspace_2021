# chap 1 nginxの概要とアーキテクチャ
## 1.1 nginxとは
- nginxは軽量で高いスケーラビリティを誇るオープンソースのHTTPサーバ
- イベント駆動
- I/O Multiplexing
- ノンブロッキングI/O
- 非同期I/O

### nginxの特徴
nginxはHTTPサーバとしての基本的な機能以外にも実用的な機能がある
- アクセス制御
- URI Rewrite
- gzip圧縮
- リバースプロキシ
- L7ロードバランス
- コンテンツキャッシュ
- SSLターミネーション、HTTP/2ゲートウェイ
- L4(TCP)ロードバランス
- メールプロキシ

## 1.2 nginxのアーキテクチャ
- nginxはイベント駆動
- httpサーバで発生するイベントは
  - クライアントからの接続要求
  - 通信用ディスクリプタが書き込み可能になる
  - ～が読み込み可能になる

### I/O処理の効率化
- preforkもでるのapacheでは一連の処理を１プロセスで行う
  - 接続が多くなるとオーバーヘッド
- イベント駆動であれば同状況でのオーバーヘッドが小さくなる
  - I/Oをノンブロッキングや非同期にする工夫が必要

#### I/O Multiplexing
- 複数のファイルディスクリプタを監視してそれらがアクティブになるまでプログラムを待機させる手法
- 複数のディスクリプタとの入出力を並行して行える
- select, kqueue, epollなどを利用する

#### ノンブロッキングI/O
- ブロッキングI/Oでは処理中のファイルディスクリプタへの処理は進行中のモノが終わるまで停止して待つ
- ノンブロッキングI/Oではこの場合にエラーを返し、リソースを他に回す
- プログラムの並行性を高めることができる

#### 非同期I/O
- ノンブロッキングとは違い、エラーを返すのではなく、進行中の処理が終わると対象プロセスに通知を飛ばすインターフェースを使用する

### nginxの実際の動作モデル
- nxinxはマスタプロセスとワーカプロセスのマルチプロセス構成で稼働する
  - ワーカプロセスが要求に対して処理を行う
  - ワーカプロセスを増やすことでスケールが可能
  - マスタプロセスはワーカプロセスを制御する